import:
  - catalog/account-map

terraform:
  backend_type: local
  backend:
    local:
      path: ../../../../state/{{ .component }}/terraform.tfstate
      workspace_dir: ../../../../state/{{ .component }}/
  metadata:
    terraform_workspace_pattern: "{component}-{environment}"
  vars:
    namespace: eg
    tenant: default
    environment: ue2
    region: us-east-2
    stage: test
    label_order:
      - namespace
      - tenant
      - environment
      - stage
      - name
      - attributes
    descriptor_formats:
      account_name:
        format: "%v-%v"
        labels:
          - tenant
          - stage
      stack:
        format: "%v-%v-%v"
        labels:
          - tenant
          - environment
          - stage

components:
  terraform:
    account-map:
      remote_state_backend:
        static:
          account_info_map:
            cptest-default:
              account_email_format: aws+cptest-%s@example.com
              eks: true
              id: '{{ getenv "TEST_ACCOUNT_ID" | default "<TEST_ACCOUNT_ID>" }}'
              ou: default
              parent_ou: none
              stage: test
              tags:
                eks: false
              tenant: default
          all_accounts:
            - cptest-default
          artifacts_account_account_name: cptest-default
          audit_account_account_name: cptest-default
          dns_account_account_name: cptest-default
          eks_accounts:
            - cptest-default
          full_account_map:
            cptest-default: '{{ getenv "TEST_ACCOUNT_ID" | default "<TEST_ACCOUNT_ID>" }}'
          iam_role_arn_templates:
            cptest-default: 'arn:aws:iam::{{ getenv "TEST_ACCOUNT_ID" | default "<TEST_ACCOUNT_ID>" }}:role/tester-%s'
          identity_account_account_name: cptest-default
          root_account_account_name: cptest-default
          terraform_roles:
            cptest-default: 'arn:aws:iam::{{ getenv "TEST_ACCOUNT_ID" | default "<TEST_ACCOUNT_ID>" }}:role/tester-terraform'
